<!DOCTYPE html>
<html>
<head>
    <title>Virtual Giving Tree</title>
    <style>
        .tree-container {
            position: relative;
            width: 800px;
            height: 600px;
            margin: 0 auto;
        }
        .branch {
            position: absolute;
            width: 150px;
            height: 60px;
            background: #2d5a27;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .branch-label {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }
        /* Branch positions */
        #branch-0 { transform: rotate(-30deg) translateX(120px) translateY(-50px); }
        #branch-1 { transform: rotate(-15deg) translateX(140px) translateY(-30px); }
        #branch-2 { transform: rotate(0deg) translateX(160px) translateY(-10px); }
        #branch-3 { transform: rotate(15deg) translateX(140px) translateY(10px); }
        #branch-4 { transform: rotate(30deg) translateX(120px) translateY(30px); }
    </style>
</head>
<body>
    <div class="tree-container">
        <div id="branch-0" class="branch"></div>
        <div id="branch-1" class="branch"></div>
        <div id="branch-2" class="branch"></div>
        <div id="branch-3" class="branch"></div>
        <div id="branch-4" class="branch"></div>
    </div>

    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        const socket = io('http://localhost:5000', {
            reconnection: true,
            reconnectionAttempts: Infinity
        });

        socket.on('connect', () => {
            console.log('Connected:', socket.connected);
            socket.emit('request_initial_state');
        });

        socket.on('new_donor_label', (data) => {
            const branch = document.getElementById(`branch-${data.branchIndex}`);
            if (branch) {
                branch.innerHTML = `
                    <div class="branch-label">
                        <strong>${data.name}</strong><br>
                        $${data.amount.toFixed(2)}
                    </div>
                `;
                branch.style.transform += ' scale(1.1)';
                setTimeout(() => {
                    branch.style.transform = branch.style.transform.replace(' scale(1.1)', '');
                }, 300);
            }
        });

        socket.on('initial_tree_state', (state) => {
            state.branches.forEach((status, index) => {
                if (status !== 'empty') {
                    const donor = status.replace('donor_', '');
                    document.getElementById(`branch-${index}`).innerHTML = `
                        <div class="branch-label">${donor}</div>
                    `;
                }
            });
        });
    </script>
</body>
</html>